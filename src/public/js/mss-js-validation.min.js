const csrfToken=$('meta[name="csrf-token"]').attr("content");function validate(e){e.select2=!!e.select2,e.submit=!!e.submit,e.fileValidate=!!e.fileValidate;let{rules:l}=e;return new Promise((t,s)=>{let r=getFormData(e);r.append("rules",JSON.stringify(l)),$.ajax({type:"POST",url:e.url,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":csrfToken},data:r,success(l){handleSuccess(e),e.submit&&$("form").submit(),t(l)},error(l){console.log(l),handleError(e,l.responseJSON.errors),s(l)}})})}function validateNew(e){let{rules:l,messages:t,submit:s}=e;return new Promise((r,n)=>{let a=getFormData(e);a.append("rules",JSON.stringify(l)),a.append("messages",JSON.stringify(t)),$.ajax({type:"POST",url:"/mss-validation/validate",processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":csrfToken},data:a,success(l){handleSuccess(e),s&&$("form").submit(),r(l)},error(l){console.log(l),handleError(e,l.responseJSON.errors),n(l)}})})}function getFormData(e){let{keys:l,fileValidate:t}=e,s=new FormData;return l.forEach(function(e){let l=$('[name="'+e+'"]');if(l.length>0){if(l.is(":radio")){let r=$('[name="'+e+'"]:checked');r.length>0&&s.append(e,r.val())}else if(l.is(":file")&&t){var n=l[0].files[0];n&&s.append(e,n)}else l.is(":checkbox")?s.append(e,l.prop("checked")):s.append(e,l.val())}else{let a=$('[name="'+e+'[]"]');a.length>0&&s.append(e,a.val())}}),s}function handleSuccess(e){let{keys:l,select2:t}=e;l.forEach(e=>{let l=$('[name="'+e+'"]');if(l.length>0){(l=resolveElm(l)).is("select")&&l.hasClass("select2")&&t&&(el=resolveElm(el=(parent=l.parent()).find(".select2-selection.select2-selection--single")));let s=$(`.${e}-err`);s.length>0&&s.remove()}else{let r=$('[name="'+e+'[]"]');if(r.length>0){parent=r.parent(),(el=r.prop("multiple")?parent.find(".select2-selection.select2-selection--multiple"):parent.find(".select2-selection.select2-selection--single")).length>0&&(el=resolveElm(el));let n=$(`.${e}-err`);n.length>0&&n.remove()}}})}function handleError(e,l){let{keys:t,select2:s}=e,r=Object.keys(l),n=t.filter(e=>!r.includes(e));for(let a in l){let o=$('[name="'+a+'"]'),i;var c=$("<small>",{class:`red-text mt-3 me-3 ${a}-err`,text:l[a][0]});if(o.length>0){(o=errorElm(o)).is(":radio")?i=$('[name="'+a+'"]:checked').parent().parent():o.is("select")&&o.hasClass("select2")&&s?el=errorElm(el=(i=o.parent()).find(".select2-selection.select2-selection--single")):i=(i=o.parent()).hasClass("input-group")?i.parent():i;let m=$(`.${a}-err`);m.length>0&&m.remove(),i.append(c)}else{let p=$('[name="'+a+'[]"]');if(p.length>0){i=(p=errorElm(p)).parent(),(el=p.prop("multiple")?i.find(".select2-selection.select2-selection--multiple"):i.find(".select2-selection.select2-selection--single")).length>0&&(el=errorElm(el));let d=$(`.${a}-err`);d.length>0&&d.remove(),i.append(c)}}}n.forEach(e=>{let l=$('[name="'+e+'"]');if(l.length>0){(l=resolveElm(l)).is("select")&&l.hasClass("select2")&&s&&(el=resolveElm(el=(parent=l.parent()).find(".select2-selection.select2-selection--single")));let t=$(`.${e}-err`);t.length>0&&t.remove()}else{let r=$('[name="'+e+'[]"]');if(r.length>0){parent=(r=resolveElm(r)).parent(),(el=r.prop("multiple")?parent.find(".select2-selection.select2-selection--multiple"):parent.find(".select2-selection.select2-selection--single")).length>0&&(el=resolveElm(el));let n=$(`.${e}-err`);n.length>0&&n.remove()}}})}function resolveElm(e){return e.hasClass("resolve")||e.addClass("resolve"),e.hasClass("error")&&e.removeClass("error"),e}function errorElm(e){return e.hasClass("error")||e.addClass("error"),e.hasClass("resolve")&&e.removeClass("resolve"),e}
